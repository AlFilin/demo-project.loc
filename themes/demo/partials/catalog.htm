{% set obCategoryList = CategoryList.make().tree() %}
{% set obCartPositionList = Cart.get() %}

{% set obCategory = CategoryPage.get() %}

{% if obCategory != null %}
{% set obProductList = ProductList.make().sort(ProductList.getSorting()).active().category(obCategory.id, true) %}
{% else %}
{% set obProductList = ProductList.make().sort(ProductList.getSorting()).active().take(20) %}
{% endif %}

{% set iPage = Pagination.getPageFromRequest() %}
{% set iCount = obProductList.count() %}

{# Apply pagination to product collection and get array with product items #}
{% set obProductList = obProductList.page(iPage, Pagination.getCountPerPage()) %}

{% set arSEOParams = {'category': obCategory} %}

{% put seo_tags %}
{% component 'SeoToolbox' model=obCategory params=arSEOParams %}
{% endput %}

{% set arBreadcrumbs = [
{'active': true, 'name': obCategory.name }
] %}

<section class=" m-0 m-auto pt-20 mb-24 max-xl:pt-12 max-w-block" id="catalog">
    <div class="max-w-block m-0 m-auto font-futura mx-5">
        <div
            class="grid grid-cols-[400px_auto] items-center mb-20 max-mdtwo:grid-cols-1 max-mdtwo:items-start max-mdtwo:mb-10">
            <h2 class="text-5xl font-inter font-medium max-xl:text-4xl">Каталог мебели</h2>
            <span class="h-2 bg-brown w-full max-mdtwo:h-1"></span>
            {% partial 'breadcrums' wrapperClass='catalog__breadcrumbs' arBreadcrumbs=arBreadcrumbs   %}
        </div>

        <form
            class="flex justify-center items-center text-2xl mb-20 mr-9 max-sm:flex-col max-sm:mb-8 max-sm:items-start"
            action="" method="post">
            <label class="mr-16 font-inter max-smtwo:mr-10 max-sm:mb-5" for="sorting">Сортировать:</label>
            <select
                class="w-[270px] border border-brown rounded-md p-4 max-smtwo:w-[200px] bg-right-1 text-text-gray/50 text-2xl  hover:text-brown focus:text-brown focus:ring-brown focus:border-brown"
                name="sorting" id="sorting">
                <option value="1">По алфавиту</option>
                <option value="2">По убыванию цены</option>
                <option value="3">По возрастанию цены</option>
                <option value="4">По популярности</option>
            </select>
        </form>
        <div class="grid grid-cols-[400px_auto] max-lg:grid-cols-1 max-1.5lg:grid-cols-[330px_auto]">
            <div class="blog-nav mr-10">
                <div class="blog-nav-button">
                    <button class="blog-nav__btn">Категории</button>
                    <button class="blog-nav__close">
                        <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="8.95386" y="7.30435" width="11.6645" height="2.33291"
                                  transform="rotate(45 8.95386 7.30435)"
                                  fill="#999999"/>
                            <rect x="7.30432" y="15.5524" width="11.6645" height="2.33291"
                                  transform="rotate(-45 7.30432 15.5524)"
                                  fill="#999999"/>
                            <circle cx="12" cy="12" r="11" stroke="#999999" stroke-width="2"/>
                        </svg>
                    </button>
                </div>
                {% partial 'menu' %}
            </div>
            <div class="max-w-[1096px]">
                <ul class="grid grid-cols-3 gap-32 mb-20 text-2xl text-brown max-2xl:gap-20 max-xl:gap-10 max-md:grid-cols-2 max-lg:justify-items-center max-sm:gap-3 max-smtwo:mb-7 max-mini:text-lg">

                    {% if obProductList is not empty %}
                    {% for obProduct in obProductList %}
                    {% set obOffer = obProduct.offer.first() %}
                    {% partial 'product-card' %}
                    {% endfor %}
                </ul>
                {% else %}
                {% set obProductList = ProductList.make().active().category(22).take() %}

                {% endif %}
            </div>
        </div>
    </div>
</section>

class c{constructor(){this.sComponentMethod="onAjax",this.obAjaxRequestCallback=null}send(t={}){this.obAjaxRequestCallback!==null&&(t=this.obAjaxRequestCallback(t)),console.log(t),oc.ajax(this.sComponentMethod,t)}setAjaxRequestCallback(t){return this.obAjaxRequestCallback=t,this}}const o=new class{constructor(){this.sBaseURL=`${location.origin}${location.pathname}`,this.init()}init(){this.sSearchString=window.location.search.substring(1),this.obParamList={},this.sSearchString.split("&").forEach(e=>{let i=e.indexOf("=");if(i<0)return;let r=e.substring(0,i),a=e.substring(i+1);!r&&!a||(this.obParamList[r]=a.split("|"))})}clear(){this.obParamList={},history.pushState(null,null,`${this.sBaseURL}`)}update(){this.generateSearchString(),Object.keys(this.obParamList).length>0?history.pushState(null,null,`${this.sBaseURL}?${this.sSearchString}`):history.pushState(null,null,`${this.sBaseURL}`)}generateSearchString(){let t=Object.keys(this.obParamList);this.sSearchString="",t.forEach(e=>{this.sSearchString.length>0&&(this.sSearchString+="&"),this.sSearchString+=`${e}=${this.obParamList[e].join("|")}`})}set(t,e){!t||!e||(typeof e=="string"&&(e=[e]),this.obParamList[t]=e)}remove(t){!t||!this.obParamList.hasOwnProperty(t)||delete this.obParamList[t]}};class h{constructor(t=null){this.obProductListHelper=t,this.sEventType="change",this.sFiledName="sort",this.sDefaultSelectClass="_shopaholic-sorting",this.sSelectSelector=`.${this.sDefaultSelectClass}`}init(){document.addEventListener(this.sEventType,t=>{const e=t.target;if(e&&e.matches(this.sSelectSelector)){t.preventDefault();const i=e.value;if(o.init(),o.set(this.sFiledName,[i]),o.update(),!this.obProductListHelper)return;this.obProductListHelper.send()}})}}const n=new class{constructor(){this.sBaseURL=`${location.origin}${location.pathname}`,this.init()}init(){this.sSearchString=window.location.search.substring(1),this.obParamList={},this.sSearchString.split("&").forEach(e=>{let i=e.indexOf("=");if(i<0)return;let r=e.substring(0,i),a=e.substring(i+1);!r&&!a||(this.obParamList[r]=a.split("|"))})}clear(){this.obParamList={},history.pushState(null,null,`${this.sBaseURL}`)}update(){this.generateSearchString(),Object.keys(this.obParamList).length>0?history.pushState(null,null,`${this.sBaseURL}?${this.sSearchString}`):history.pushState(null,null,`${this.sBaseURL}`)}generateSearchString(){let t=Object.keys(this.obParamList);this.sSearchString="",t.forEach(e=>{this.sSearchString.length>0&&(this.sSearchString+="&"),this.sSearchString+=`${e}=${this.obParamList[e].join("|")}`})}set(t,e){!t||!e||(typeof e=="string"&&(e=[e]),this.obParamList[t]=e)}remove(t){!t||!this.obParamList.hasOwnProperty(t)||delete this.obParamList[t]}};class u{constructor(t=null){this.obProductListHelper=t,this.sEventType="click",this.sFiledName="page",this.sAttributeName="data-page",this.sDefaultButtonClass="_shopaholic-pagination",this.sButtonSelector=`.${this.sDefaultButtonClass}`}init(){document.addEventListener(this.sEventType,t=>{const e=t.target;if(!e.matches(this.sButtonSelector))return;t.preventDefault(),t.stopPropagation();const i=e.getAttribute(this.sAttributeName);n.init(),i=="1"?n.remove(this.sFiledName):n.set(this.sFiledName,[i]),n.update(),this.obProductListHelper&&this.obProductListHelper.send()})}setButtonSelector(t){return this.sButtonSelector=t,this}}const l=new c;l.setAjaxRequestCallback(s=>(console.log("isorting",s),s.update={"catalog/catalog-ajax":".catalog_wrapper"},s));const d=new u(l);d.init();const g=new h(l);g.init();document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",function(s){if(s.target.name==="add-to-cart"){s.target.innerHTML="Добавлено";const i={cart:[{offer_id:s.target.getAttribute("data-offer-id"),quantity:1}]};oc.ajax("Cart::onAdd",{data:i,success(){var r=document.querySelector(".errorField");document.querySelector(".errorMsg"),document.querySelector(".errorMsg").style.display="block",r.innerHTML="Товар добавлен в корзину",document.getElementById("loadingmessage").style.display="block",setTimeout(function(){document.getElementById("loadingmessage").style.display="none"},3e3)},error(){alert("Ошибка добавления в корзину")}})}}),document.body.addEventListener("click",function(s){s.target.name==="cartClearBtn"&&oc.ajax("Cart::onClear",{success(){location.reload()}})}),document.querySelectorAll(".cart-product__remove").forEach(s=>{s.addEventListener("click",function(){var t=[this.getAttribute("data-offer-id")],e={cart:t,shipping_type_id:1,payment_method_id:1};oc.ajax("Cart::onRemove",{data:e,success:function(){location.reload()}})})})});

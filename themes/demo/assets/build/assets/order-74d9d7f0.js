document.querySelector("#addOrder").addEventListener("click",function(){let n=1,e=1,i=document.getElementById("email").value,o=document.getElementById("name").value,t=document.getElementById("tele").value,r=document.getElementById("last-name").value,a=document.getElementById("#resultPrice").value;var u=document.querySelector("._ajax_create_order"),d=document.querySelector("#orderProperty").value,l=document.querySelector(".errorField");document.querySelector(".errorMsg");var c=new Array("user[name]","user[email]","user[phone]"),f=new Array("Ваше имя","электронный адрес","номер телефона");let h={order:{payment_method_id:n,shipping_type_id:e,property:{orderHelper:d,resultPrice:a}},user:{email:i,name:o,last_name:r,phone:t}};x(u,c,f);function x(y,v,A){var s,p;for(p=0;p<v.length;p++)for(s=0;s<y.length;s++){if(y.elements[s].name==v[p]&&y.elements[s].value=="")return document.querySelector(".errorMsg").style.display="block",l.innerHTML="Пожалуйста, введите "+A[p],y[0].animate([{transform:"rotate(0deg)"},{transform:"rotate(0deg)"},{transform:"rotate(5deg)"},{transform:"rotate(-5deg)"},{transform:"rotate(0deg)"}],{duration:100,iterations:2,delay:300}),document.getElementById("loadingmessage").style.display="block",setTimeout(function(){document.getElementById("loadingmessage").style.display="none"},3e3),y.elements[s].focus(),!1;oc.ajax("MakeOrder::onCreate",{data:h,success:function(m){if(m){if(m.X_OCTOBER_REDIRECT)return this.success(m);if(m.status)return this.success(m)}}})}}return!1});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".product-card__quantity__input").forEach(function(r){r.addEventListener("change",function(){var a=this.closest("tr"),u=parseInt(this.value);a.setAttribute("data-quantity",u);var d=parseFloat(a.querySelector(".priceSqu").getAttribute("data-original-price"));q(a,u,d),g()})});var n=document.querySelector("#originalTable"),e=document.querySelector("#additionalTableBlock");i(n),i(e),document.querySelectorAll(".addToAdditionalTable").forEach(function(r){r.addEventListener("click",function(){var a=this.closest("tr"),u=this.textContent.includes("Объединить");a.style.transition="opacity 0.5s",a.style.opacity=0,setTimeout(function(){u?(e.querySelector("tbody").appendChild(a),r.textContent="Убрать из набора"):(n.appendChild(a),r.textContent="Объединить в набор");var d=parseInt(a.getAttribute("data-quantity"))||1,l=parseFloat(a.querySelector(".priceSqu").getAttribute("data-original-price"));q(a,d,l,u),a.style.opacity=1,i(n),i(e),P(e),g(),S()},500)})});function i(r){r.querySelectorAll("tr").length===1?r.style.display="none":r.style.display="block"}function o(r,a,u){var d=parseFloat(u),l=d*(a?.9:1);r.innerHTML="";var c=document.createElement("span");c.textContent=`${l.toFixed(2)}р`,r.appendChild(c);var f=r.closest(".resultItemPrice");f&&f.setAttribute("data-current-price",l.toFixed(2))}function t(r,a){var u=r.querySelectorAll(".priceSqu"),d=r.querySelectorAll(".resultItemPrice");u.forEach(function(l){var c=l.getAttribute("data-original-price");c||(c=l.textContent.replace("р",""),l.setAttribute("data-original-price",c)),o(l,a,c)}),d.forEach(function(l){var c=l.getAttribute("data-original-price");c||(c=l.textContent.replace("р",""),l.setAttribute("data-original-price",c)),o(l,a,c)})}t(e,!0),t(n,!1),S()});function g(){var n=document.querySelectorAll(".resultItemPrice"),e=0;n.forEach(function(o){var t=parseFloat(o.getAttribute("data-current-price"));isNaN(t)||(e+=t)}),document.querySelector(".giftBox")&&(e+=2e3);var i=document.querySelector("#resultPriseVal");i.textContent=e.toFixed(2),i.value=e.toFixed(2)}function P(n){var e=n.querySelector(".giftBox"),i=n.querySelectorAll(" tr:not(.giftBox)").length>1;if(i&&!e){var o=document.createElement("tr");o.classList.add("giftBox"),o.innerHTML="<td>Подарочная коробка</td><td></td><td>2000 рублей</td>",n.querySelector("tbody").prepend(o)}else!i&&e&&e.remove();var t=document.querySelector("#additionalTableBlock");t.querySelectorAll("tr").length===1?t.style.display="none":t.style.display="block"}function q(n,e,i,o){var t=i*e;o&&(t*=.9);var r=n.querySelector(".resultItemPrice");r.textContent=t.toFixed(2)+"р",r.setAttribute("data-current-price",t.toFixed(2))}function S(){var n=[],e={originalTable:"Не в наборе",additionalTableBlock:"Сложить в набор"};Object.keys(e).forEach(function(i){var o=document.querySelector("#"+i).querySelectorAll("tbody tr:not(.giftBox)");o.forEach(function(t){var r=t.querySelector("td:first-child").textContent.trim(),a=t.querySelector(".articul").textContent.trim(),u=t.querySelector(".pricePerUnit").textContent.replace("р","").trim(),d=t.querySelector(".product-card__quantity__input")?t.querySelector(".product-card__quantity__input").value:"1";n.push({Артикул:a,Название:r,Стоимость:u,Количество:d,"Складывать ли в набор":e[i]})})}),_(n)}function _(n){var e=document.querySelector("#orderProperty");if(e){var i=JSON.stringify(n,null,2),o=i.split("},").map(t=>t.replace(/[\{\}\[\]"',]/g,"").replace(/\n\s+/g,`
`).trim()).join(`

`);e.value=o}}
